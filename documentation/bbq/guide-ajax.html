<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Mar 6, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
        <style>body{padding-top: 60px;}</style>
    
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>
    
    <link rel="stylesheet" href="./highlighter/SyntaxHighlighter.css" />
    <script type="text/javascript" src="./highlighter/shCore.js"></script>
    <script type="text/javascript" src="./highlighter/shBrushJScript.js"></script>
    <script type="text/javascript" src="./highlighter/shBrushJava.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20120306" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
  <body>
                        
                    
        <div id="topbar" class="topbar" data-dropdown="dropdown">
      <div class="topbar-inner">
                <div class="container">
                
                                            <a class="brand" href="http://achingbrain.github.com/maven-repo/documentation/bbq"  title="BBQjs">

                                
                                                                                                                    <img src="images/topbar-logo.png" alt="BBQjs" />
                
                </a>
                    
          <ul>
                        <li class="dropdown" data-dropdown="dropdown" >
        <a href="#" class="dropdown-toggle">Overview</a>
        <ul class="dropdown-menu">
                      <li>      <a href="index.html"  title="Introduction">Introduction</a>
</li>
                      <li>      <a href="license.html"  title="License">License</a>
</li>
                  </ul>
      </li>
                <li class="dropdown" data-dropdown="dropdown" >
        <a href="#" class="dropdown-toggle">Documentation</a>
        <ul class="dropdown-menu">
                      <li>      <a href="design-goals.html"  title="Design goals">Design goals</a>
</li>
                      <li>      <a href="guide.html"  title="Guide">Guide</a>
</li>
                  </ul>
      </li>
                <li class="dropdown" data-dropdown="dropdown" >
        <a href="#" class="dropdown-toggle">Infrastructure</a>
        <ul class="dropdown-menu">
                      <li>      <a href="issue-tracking.html"  title="Issue tracking">Issue tracking</a>
</li>
                      <li>      <a href="source-repository.html"  title="Source control">Source control</a>
</li>
                      <li>      <a href="team-list.html"  title="Team">Team</a>
</li>
                  </ul>
      </li>
                </ul>
                      <form action="http://www.google.com/search" method="get" class="pull-right">
  <input value="achingbrain.github.com/maven-repo/documentation/bbq" name="sitesearch" type="hidden"/>
  <input class="mini" size="5" name="q" id="query" type="text" value="search..." onclick="if(this.value == 'search...') {this.value = ''}"/>
  <input name="Search" value="Go" type="submit"/>
</form>
                            </div>
      </div>
    </div>
    
        <div class="container">
          
      <div id="breadcrumbs">

      </div>

      
      <div id="bodyColumn" class="content">
        <div id="contentBox">
                              
          <h2>AJAX Requests</h2>

<p>AJAX requests are made using a subclass of <a href="bbq-js/jsdoc/symbols/bbq.ajax.AJAXRequest.html">AJAXRequest</a>.  The different subclasses send and receive data in different formats.</p>

<p>The constructor arguments for all subclasses are similar however they differ in how they serialize/deserialize the data for transmission.</p>

<p>The serialized form is sent as the body of a HTTP POST request, consequently HTTP GET is not supported.  The reason for this is that the POST body can be arbitrarily long, whereas some browsers place limits on how much data can be sent as a request header.</p>

<h3> X-BBQ-ResponseType header</h3>

<p>bbq expects responses to all AJAX requests to have a header named X-BBQ-ResponseType present.  The header should have an integer value - a negative number indicates an error occurred whereas 0 or a positive number indicates the call was successful.</p>

<h3>Handling server side errors</h3>

<p>There are two ways to handle server side errors - per request and global.</p>

<h4>Per request</h4>

<p>To handle errors on a per-request basis, simply pass an onFailure argument to the AJAXRequest's options object:</p>

<pre><code class="language-javascript">
new bbq.ajax.JSONRequest({
    url: "/path/to/handler",
    onFailure: function(serverResponse) {
        // the argument is the XMLHttpRequest object
    }
});
</code></pre>

<h4>Global error handlers</h4>

<p>To define global error handlers, make an entry in the <code>bbq.ajax.AJAXRequest.errorHandlers</code> object that corresponds to the X-BBQ-ResponseType error code.  Error handlers should be a function with the following signature:</p>

<pre><code class="language-javascript">
function(bbq.ajax.AJAXRequest, XMLHttpRequest);
</code></pre>

<p>So, for example, if a MySpuriousException thrown on the server results in a  X-BBQ-ResponseType error code of -42, you'd catch it like so:</p>

<pre><code class="language-javascript">
bbq.ajax.AJAXRequest.errorHandlers["error-42"] = function(request, response) {
    Log.warn("MySpuriousException was thrown!");
};
</code></pre>

<p>This is useful for detecting fatal errors that affect more than just the current request such as the user not being logged in.</p>

<h3>JSONRequest</h3>

<p><a href="bbq-js/jsdoc/symbols/bbq.ajax.JSONRequest.html">JSONRequest</a> sends and receives data in the <a href="http://www.json.org">JSON</a> format.</p>

<pre><code class="language-javascript">
new bbq.ajax.JSONRequest({
    url: "/path/to/handler",
    args: {
        foo: "bar"
    },
    onSuccess: function(serverResponse, json) {
        // the first argument is the XMLHttpRequest object
        // the second is the deserialized response body
    }
});
</code></pre>

<p>The example above will result in the below JSON being sent to "http://example.org/path/to/handler", where example.org is the domain your app runs on.</p>

<pre><code>{"foo":"bar"}
</code></pre>

<p>See the <a href="bbq-js/jsdoc/symbols/bbq.ajax.JSONRequest.html">JSDocs</a> for further discussion.</p>

<h4>JSON authentication</h4>

<p>All cookies from the user session are sent along with the request so you should be able to configure authentication/session management for JSONRequests as you would any web page.</p>

<h3>SoapRequest</h3>

<p><a href="bbq-js/jsdoc/symbols/bbq.ajax.SoapRequest.html">SoapRequest</a> is similar to JSONRequest except the message body is sent as a <a href="http://www.w3.org/TR/soap/">SOAP</a> envelope.</p>

<p>SoapRequest requires two extra arguments: action and namespace.  Action defines the name of the outgoing element - MyAction would be turned into MyActionRequest and tells SoapRequest to expect a MyActionResponse element in the server response.  Namespace is the namepace to use for the elements in the request.  See the example below.</p>

<pre><code class="language-javascript">
new bbq.ajax.SoapRequest({
    url: "/path/to/handler",
    action: "MyAction",
    namespace: "http://example.org/myns"
    args: {
        foo: "bar"
    },
    onSuccess: function(serverResponse, soap) {
        // the first argument is the XMLHttpRequest object
        // the second is the deserialized response body
    }
});
</code></pre>

<p>This will result in the following request body:</p>

<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;" + 
&lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
    &lt;soapenv:Body&gt;
        &lt;MyActionRequest xmlns="http://example.org/myns"&gt;
            &lt;foo&gt;bar&lt;/foo&gt;
        &lt;/MyActionRequest&gt;
    &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</code></pre>

<h4>Soap authentication</h4>

<p>Your SOAP requests can be authenticated by passing a <a href="bbq-js/jsdoc/symbols/bbq.ajax.SoapUsernameDigestToken.html">SoapUsernameDigestToken</a> to a SoapRequest as the authentication argument to the options object.</p>

<pre><code class="language-javascript">
new bbq.ajax.SoapRequest({
    url: "/path/to/handler",
    action: "MyAction",
    namespace: "http://example.org/myns"
    args: {
        foo: "bar"
    },
    authentication: new bbq.ajax.SoapUsernameDigestToken({
        username: "myusername",
        password: "mypassword"
    }),
    onSuccess: function(serverResponse, soap) {
        // the first argument is the XMLHttpRequest object
        // the second is the deserialized response body
    }
});
</code></pre>

<p>This results in the following request body:</p>

<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;" + 
&lt;soapenv:Envelope xmlns:soapenv="http://www.w3.org/2003/05/soap-envelope"&gt;
    &lt;soapenv:Header xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"&gt;
        &lt;wsse:Security soapenv:mustUnderstand="true"&gt;
            &lt;wsse:UsernameToken&gt;
                &lt;wsse:Username&gt;myusername&lt;/wsse:Username&gt;
                &lt;wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest"&gt;sha1hashedpassword&lt;/wsse:Password&gt;
                &lt;wsse:Nonce&gt;randomstring&lt;/wsse:Nonce&gt;
                &lt;wsu:Created&gt;datetime&lt;/wsu:Created&gt;
            &lt;/wsse:UsernameToken&gt;
        &lt;/wsse:Security&gt;
    &lt;/soapenv:Header&gt;
    &lt;soapenv:Body&gt;
        &lt;MyActionRequest xmlns="http://example.org/myns"&gt;
            &lt;foo&gt;bar&lt;/foo&gt;
        &lt;/MyActionRequest&gt;
    &lt;/soapenv:Body&gt;
&lt;/soapenv:Envelope&gt;
</code></pre>

<p>See the <a href="bbq-js/jsdoc/symbols/bbq.ajax.SoapRequest.html">JSDocs</a> for further discussion.</p>

<h3> Forwarding requests</h3>

<p>Most web browsers use the <a href="http://en.wikipedia.org/wiki/Same_origin_policy">Same origin policy</a> as a security model for JavaScript.  This means that typically interactions in JavaScript are limited to operating on the domain the script was loaded from.  From an AJAX point of view this means that if your script was loaded from http://www.example.org, you cannot make AJAX requests to http://api.nexthotwebapp.com.</p>

<p>To work around this limitation bbq provides <a href="bbq-js/jsdoc/symbols/bbq.ajax.ForwardingJSONRequest.html">ForwardingJSONRequest</a> and <a href="bbq-js/jsdoc/symbols/bbq.ajax.ForwardingSoapRequest.html">ForwardingSoapRequest</a>.  These clases are designed to be used with the <a href="bbq-spring-integration/apidocs/org/bbqjs/spring/ajax/RequestForwarder.html">RequestForwarder</a> class in the <a href="bbq-spring-integration/index.html">bbq-spring-integration</a> module.  Please see the relevant JSDoc/JavaDoc pages for further discussion.</p>

                  </div>
      </div>
    </div>

    <footer class="footer">
            <div class="container">
      

         <ul class="breadcrumb">
            <li class="copyright">Copyright &copy;                   2012.
          All Rights Reserved.      
        
      </li>
                  
        
                  <li id="publishDate">Last Published: 2012-03-06</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.1.4-SNAPSHOT</li>
                                        
        
               </ul>

        
                <p id="poweredBy" class="pull-right">
                          <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
              </p>
              </div>
    </footer>

	<script type="text/javascript">

$("pre").addClass("prettyprint linenums");
$("code").each(function(index, node) {
node.innerHTML = node.innerHTML.trim();
});
prettyPrint();

	</script>
  </body>
</html>
